<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROI Calculator</title>
  <!-- Include Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/validator/validator.min.js"></script>
  <!-- Include Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Ensure the dropdown stays within the viewport */
    #doc-types-dropdown {
      position: absolute; /* Position relative to the nearest positioned ancestor */
      z-index: 1000; /* Ensure it appears above other elements */
      width: 100%; /* Match the width of the parent container */
      max-height: 200px; /* Limit the dropdown height */
      overflow-y: auto; /* Scroll if options overflow */
      background-color: white; /* Background color for visibility */
      border: 1px solid #d1d5db; /* Light border */
      border-radius: 0.375rem; /* Rounded corners */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow for a floating effect */
    }
  
    /* Hide dropdown initially */
    #doc-types-dropdown.hidden {
      display: none;
    }
  
    #doc-types-container {
      position: relative; /* Ensure the dropdown positions relative to this container */
    }

    /* Highlight invalid fields */
    input.error {
      border-color: #e53e3e; /* Red border */
      border-width: 2px;
    }

    /* Error message styling */
    .error-message {
      color: #e53e3e; /* Red text */
      font-size: 0.75rem; /* Smaller font size */
      margin-top: 0.25rem;
    }

    #error {
      border-color: #e53e3e; /* Red border for error */
      border-width: 2px;
    }

  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-white to-gray-100">
  <!-- Header -->
  <header class="bg-gradient-to-r from-green-500 via-blue-500 to-indigo-700 shadow-lg">
    <div class="max-w-7xl mx-auto py-4 px-6 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-white">ROI Calculator</h1>
      <p class="text-white text-sm">Analyze Costs & Savings with Intelligent Document Processing</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-6 py-12 space-y-12">
    <!-- General Inputs -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <h3 class="text-lg font-medium text-gray-900">General Inputs</h3>
        <p class="mt-1 text-sm text-gray-500">Provide details about monthly pages and document types. Fields marked with <span class="text-red-600">*</span> are mandatory.</p>
      </div>
      <div class="space-y-6">
        <div>
          <label for="num-pages" class="block text-sm font-medium text-gray-700">Average # of Monthly Pages <span class="text-red-600">*</span></label>
          <input type="number" id="num-pages" name="num-pages" required
            class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
        </div>
        <div>
          <div class="flex items-center justify-between">
            <label for="doc-types" class="block text-sm font-medium text-gray-700">Document Types</label>
            <span id="doc-type-count" class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
              0 Selected
            </span>
          </div>
          <div id="doc-types-container"
            class="flex items-center gap-2 border border-gray-300 rounded-md bg-white px-3 py-1.5 shadow-sm overflow-x-auto relative">
            <input id="doc-types" placeholder="Type or select document types"
              class="flex-grow bg-transparent outline-none text-sm text-gray-900 placeholder-gray-400" />
          </div>
          <ul id="doc-types-dropdown"
            class="absolute z-10 mt-1 w-full max-w-[300px] bg-white border border-gray-300 rounded-md shadow-lg max-h-40 overflow-y-auto hidden">
            <!-- Suggestions dynamically inserted -->
          </ul>
        </div>
      </div>
    </section>

    <!-- Data Entry Section -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <h3 class="text-lg font-medium text-gray-900">Data Entry Inputs</h3>
        <p class="mt-1 text-sm text-gray-500">Provide team configuration details for USA and Offshore data entry teams.</p>
      </div>
      <div class="space-y-6">
        <!-- USA Data Entry -->
        <div>
          <h4 class="text-md font-semibold text-gray-900 mb-4">USA Data Entry (Default)</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label for="usa-ft" class="block text-sm font-medium text-gray-700">Full-Time Members</label>
              <input type="number" id="usa-ft" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="usa-ft-time" class="block text-sm font-medium text-gray-700">% Time Spent</label>
              <input type="number" id="usa-ft-time" value="100"
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="usa-ft-rate" class="block text-sm font-medium text-gray-700">Hourly Rate (USD)</label>
              <input type="number" id="usa-ft-rate" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <!-- Part-Time Members -->
            <div>
              <label for="usa-pt" class="block text-sm font-medium text-gray-700">Part-Time Members</label>
              <input type="number" id="usa-pt" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="usa-pt-time" class="block text-sm font-medium text-gray-700">% Time Spent</label>
              <input type="number" id="usa-pt-time" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="usa-pt-rate" class="block text-sm font-medium text-gray-700">Hourly Rate (USD)</label>
              <input type="number" id="usa-pt-rate" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
          </div>
        </div>

        <!-- Offshore Toggle -->
        <div class="flex items-center mt-4">
          <input type="checkbox" id="toggle-offshore"
            class="mr-2 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
          <label for="toggle-offshore" class="text-sm text-gray-700">I also have data entry Offshore</label>
        </div>

        <!-- Offshore Data Entry -->
        <div id="offshore-section" class="hidden mt-6 space-y-4">
          <h4 class="text-md font-semibold text-gray-900 mb-4">Offshore Data Entry</h4>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label for="off-ft" class="block text-sm font-medium text-gray-700">Full-Time Members</label>
              <input type="number" id="off-ft" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="off-ft-time" class="block text-sm font-medium text-gray-700">% Time Spent</label>
              <input type="number" id="off-ft-time" value="100"
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="off-ft-rate" class="block text-sm font-medium text-gray-700">Hourly Rate (USD)</label>
              <input type="number" id="off-ft-rate" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <!-- Part-Time Members -->
            <div>
              <label for="off-pt" class="block text-sm font-medium text-gray-700">Part-Time Members</label>
              <input type="number" id="off-pt" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="off-pt-time" class="block text-sm font-medium text-gray-700">% Time Spent</label>
              <input type="number" id="off-pt-time" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
            <div>
              <label for="off-pt-rate" class="block text-sm font-medium text-gray-700">Hourly Rate (USD)</label>
              <input type="number" id="off-pt-rate" 
                class="mt-1 block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm text-base text-gray-900 placeholder-gray-400 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Business Impact Section -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <h3 class="text-lg font-medium text-gray-900">Business Impact</h3>
        <p class="mt-1 text-sm text-gray-500">Provide descriptions and dollar values for impacts.</p>
      </div>
      <div>
        <div id="business-impact-section" class="space-y-4">
          <!-- Business Impact Rows -->
        </div>
        <button type="button" id="add-impact-btn"
          class="mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">Add Business Impact</button>
      </div>
    </section>

    <!-- Buttons Section -->
    <section class="flex gap-4">
      <button type="button" id="calculate-btn" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
        Calculate ROI
      </button>
      <button type="reset" id="reset-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-900 py-2 px-4 rounded">
        Start Over
      </button>
      <button type="button" id="email-btn" class="bg-indigo-500 hover:bg-indigo-600 text-white py-2 px-4 rounded">
        Email Me
      </button>
    </section>
  </main>

  <script type="module">
    let defaultDocTypes = []; // Declare globally for shared use
    // Offshore Toggle Functionality
    const offshoreToggle = document.getElementById("toggle-offshore");
    const offshoreSection = document.getElementById("offshore-section");
    offshoreToggle.addEventListener("change", () => {
      offshoreSection.classList.toggle("hidden", !offshoreToggle.checked);
    });
  
    // Document Type Chips
    const docTypesContainer = document.getElementById("doc-types-container");
    const docTypesInput = document.getElementById("doc-types");
    const docTypesDropdown = document.getElementById("doc-types-dropdown");
    const docTypeCountBadge = document.getElementById("doc-type-count"); // Badge for count
  
    // Import Firebase modules (ensure <script> tags are present in <head>)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCTNI8ZOfSVRFm1w_V2kgVKlIfuMQoLFyc",
      authDomain: "roi-calculator-5c4a4.firebaseapp.com",
      projectId: "roi-calculator-5c4a4",
      storageBucket: "roi-calculator-5c4a4.appspot.com",
      messagingSenderId: "484775728997",
      appId: "1:484775728997:web:02fcfea46b9f568418338c"
    };

    // Global error handler to catch unexpected issues
    window.addEventListener("error", (e) => {
      console.error("Unhandled Error:", e.message);
    });

    // Initialize Firebase App and Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function fetchDocumentTypes() {
      try {
        const querySnapshot = await getDocs(collection(db, "documentTypes"));
        defaultDocTypes = querySnapshot.docs.map((doc) => doc.data().name);
        populateDocTypeDropdown(); // Pass the fetched document types
      } catch (error) {
        console.error("Error fetching document types:", error);
      }
    }

    // Call the function immediately after page load
    document.addEventListener("DOMContentLoaded", fetchDocumentTypes);
    const addedDocTypes = new Set(); // Keeps track of selected document types
    let focusedOptionIndex = -1; // Tracks focused option for dropdown navigation
  
    function clearError(input) {
      if (input.id === "doc-types-container") {
        input.classList.remove("error");

        const errorLabel = input.nextElementSibling;
        if (errorLabel && errorLabel.classList.contains("error-message")) {
          errorLabel.remove();
        }
      } else {
        input.classList.remove("error");

        const errorLabel = input.nextElementSibling;
        if (errorLabel && errorLabel.classList.contains("error-message")) {
          errorLabel.remove();
        }
      }
    }

    // Populate dropdown dynamically
    function populateDocTypeDropdown() {
      const inputValue = docTypesInput.value.toLowerCase().trim();

      // Filter available options
      const availableOptions = defaultDocTypes.filter(
        (type) => !addedDocTypes.has(type) && type.toLowerCase().includes(inputValue)
      );

      docTypesDropdown.innerHTML = ""; // Clear previous options

      // If no options are available
      if (availableOptions.length === 0) {
        docTypesDropdown.innerHTML = `<li class="px-3 py-2 text-gray-500">No document types available</li>`;
      } else {
        // Populate dropdown with available options
        availableOptions.forEach((type) => {
          const li = document.createElement("li");
          li.textContent = type;
          li.className = "cursor-pointer px-3 py-2 hover:bg-indigo-100 text-gray-700";
          li.addEventListener("click", () => {
            addChip(type);
            docTypesDropdown.classList.add("hidden"); // Hide dropdown after selection
          });
          docTypesDropdown.appendChild(li);
        });
      }

      // Show dropdown only if input has focus or user clicks inside
      if (docTypesInput === document.activeElement && (inputValue || defaultDocTypes.length > 0)) {
        docTypesDropdown.classList.remove("hidden");
      } else {
        docTypesDropdown.classList.add("hidden");
      }
    }
  
    // Add chip for selected or custom type
    function addChip(type) {
      if (!type.trim() || addedDocTypes.has(type)) return; // Ignore empty input or duplicates

      addedDocTypes.add(type); // Add to the set of selected types
      updateDocTypeCount(); // Update the count badge

      const chip = document.createElement("span");
      chip.className = "inline-flex items-center bg-blue-100 text-blue-800 text-sm font-medium px-3 py-0.5 rounded-full";
      chip.innerHTML = `${type} <button class="ml-2 text-blue-500 hover:text-blue-600 focus:outline-none">&times;</button>`;
      chip.querySelector("button").addEventListener("click", () => {
        chip.remove(); // Remove chip from DOM
        addedDocTypes.delete(type); // Remove from the set of selected types
        updateDocTypeCount(); // Update the count badge
        populateDocTypeDropdown(); // Refresh the dropdown options

        // If no chips remain, validate the container
        if (addedDocTypes.size === 0) {
          showError(docTypesContainer, "Select at least one document type.");
        }
      });

      docTypesContainer.insertBefore(chip, docTypesInput); // Add chip before the input field
      docTypesInput.value = ""; // Clear the input field
      populateDocTypeDropdown(); // Refresh the dropdown options

      // Clear validation error if applicable
      clearError(docTypesContainer);
    }
  
    // Update document type count badge
    function updateDocTypeCount() {
      const count = addedDocTypes.size;
      docTypeCountBadge.textContent = `${count} Selected`; // Update badge text
      docTypeCountBadge.style.display = count > 0 ? "inline-block" : "none"; // Hide badge if count is 0
    }
  
    // Handle keyboard navigation
    function handleDropdownNavigation(event) {
      const dropdownItems = docTypesDropdown.querySelectorAll("li");
      if (dropdownItems.length === 0) return;
  
      if (event.key === "ArrowDown") {
        event.preventDefault();
        focusedOptionIndex = (focusedOptionIndex + 1) % dropdownItems.length; // Move focus down
      } else if (event.key === "ArrowUp") {
        event.preventDefault();
        focusedOptionIndex = (focusedOptionIndex - 1 + dropdownItems.length) % dropdownItems.length; // Move focus up
      } else if (event.key === "Enter") {
        event.preventDefault();
        if (focusedOptionIndex >= 0) {
          dropdownItems[focusedOptionIndex].click(); // Select focused item
        }
      }
  
      // Update focus style
      dropdownItems.forEach((item, index) => {
        if (index === focusedOptionIndex) {
          item.classList.add("bg-indigo-100");
        } else {
          item.classList.remove("bg-indigo-100");
        }
      });
    }
  
    // Event Listeners
    let debounceTimeout = null; // Initialize with `null` to ensure it’s defined

    docTypesInput.addEventListener("input", () => {
      if (debounceTimeout) {
        clearTimeout(debounceTimeout); // Safely clear previous timeout
      }

      debounceTimeout = setTimeout(() => {
        populateDocTypeDropdown(); // Populate the dropdown after 300ms delay
      }, 300); // Delay duration
    });
    docTypesInput.addEventListener("focus", populateDocTypeDropdown); // Open dropdown on focus
    docTypesInput.addEventListener("click", populateDocTypeDropdown); // Open dropdown on click
  
    // Add chip on Enter
    docTypesInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter" && focusedOptionIndex === -1) {
        event.preventDefault(); // Prevent form submission
        addChip(docTypesInput.value.trim()); // Add chip for entered text
      }
    });
  
    // Handle Tab key to allow moving to the next field
    docTypesInput.addEventListener("keydown", (event) => {
      if (event.key === "Tab") {
        if (focusedOptionIndex !== -1) {
          event.preventDefault(); // Prevent default tabbing
          const dropdownItems = docTypesDropdown.querySelectorAll("li");
          if (dropdownItems[focusedOptionIndex]) {
            dropdownItems[focusedOptionIndex].click(); // Select the focused option
          }
        }
      }
    });
  
    // Ensure input is always clickable
    docTypesContainer.addEventListener("click", () => {
      docTypesInput.focus(); // Focus input field when container is clicked
    });
  
    // Hide dropdown and add chip on blur (if value exists)
    docTypesInput.addEventListener("blur", () => {
      setTimeout(() => {
        const inputValue = docTypesInput.value.trim();
        if (inputValue) {
          addChip(inputValue); // Add chip for remaining input value
        }
        docTypesDropdown.classList.add("hidden"); // Hide dropdown
      }, 150); // Delay to process click events
    });
  
    // Initialize badge count on page load
    document.addEventListener("DOMContentLoaded", () => {
      fetchDocumentTypes(); // Fetch document types but do not trigger dropdown.
      updateDocTypeCount(); // Ensure the badge starts with correct count.
      
      // Ensure dropdown remains hidden initially
      docTypesDropdown.classList.add("hidden");

      // Focus the first input field (optional, for usability)
      const firstInput = document.getElementById("num-pages");
      if (firstInput) {
        firstInput.focus();
      }
    });
  
    // Business Impact Rows
    const businessImpactSection = document.getElementById("business-impact-section");
    const addImpactBtn = document.getElementById("add-impact-btn");
    const availableImpacts = [
      "Business lost due to slow turnaround time",
      "Cost of errors",
      "Hiring and managing data entry team",
      "Cost of employee training related to data entry",
      "Losing business to competitor due to lack of technology edge",
    ];
  
    function createImpactRow() {
      const row = document.createElement("div");
      row.className = "grid grid-cols-12 gap-4 items-center";
  
      row.innerHTML = `
        <div class="col-span-7">
          <select class="block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm">
            <option value="" disabled selected>Select an Impact</option>
            ${availableImpacts.map((impact) => `<option value="${impact}">${impact}</option>`).join("")}
          </select>
        </div>
        <div class="col-span-4">
          <input type="number" placeholder="Value in USD" class="block w-full rounded-md bg-white border border-gray-300 px-3 py-1.5 shadow-sm">
        </div>
        <div class="col-span-1 flex justify-center items-center">
          <button type="button" class="text-red-500 hover:text-red-700">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `;
  
      const removeBtn = row.querySelector("button");
      removeBtn.addEventListener("click", () => row.remove());
  
      businessImpactSection.appendChild(row);
    }
  
    addImpactBtn.addEventListener("click", createImpactRow);
  
    // Start Over functionality
    const resetBtn = document.getElementById("reset-btn");
  
    resetBtn.addEventListener("click", () => {
      // Inline implementation of clearAllErrors
      function clearAllErrors() {
        document.querySelectorAll(".error").forEach((el) => el.classList.remove("error"));
        document.querySelectorAll(".error-message").forEach((el) => el.remove());
      }

      clearAllErrors(); // Clear all validation errors

      // Clear all document type chips
      docTypesContainer.querySelectorAll("span").forEach((chip) => chip.remove()); // Remove all chips
      addedDocTypes.clear(); // Clear the set of added document types
      updateDocTypeCount(); // Reset the count badge

      // Reset input field for document types
      docTypesInput.value = "";

      // Ensure dropdown is cleared and hidden
      docTypesDropdown.innerHTML = "";
      docTypesDropdown.classList.add("hidden");

      // Re-fetch document types and reinitialize the dropdown
      fetchDocumentTypes().then(() => {
        populateDocTypeDropdown(); // Reinitialize the dropdown
      });

      // Reset all other input fields
      const inputs = document.querySelectorAll("input");
      inputs.forEach((input) => {
        if (input.id === "usa-ft-time" || input.id === "off-ft-time") {
          input.value = "100"; // Set default value to 100 for percentage fields
        } else {
          input.value = ""; // Reset other inputs to blank
        }
      });

      // Reset dropdowns (like Business Impact)
      const selects = document.querySelectorAll("select");
      selects.forEach((select) => (select.selectedIndex = 0));

      // Clear all dynamically added Business Impact rows
      businessImpactSection.innerHTML = "";

      // Hide offshore section
      offshoreSection.classList.add("hidden");
      offshoreToggle.checked = false;

      // Scroll to the top of the page
      window.scrollTo({ top: 0, behavior: "smooth" });

      // Focus the first input field (Monthly Pages)
      const firstInput = document.getElementById("num-pages");
      if (firstInput) {
        firstInput.focus();
      }
    });
  
    // Focus the first input field on page load
    document.addEventListener("DOMContentLoaded", () => {
      const firstInput = document.getElementById("num-pages");
      if (firstInput) {
        firstInput.focus();
      }
    });
    
    // Validation code for input field
    document.addEventListener("DOMContentLoaded", () => {
      const calculateBtn = document.getElementById('calculate-btn');
      const offshoreToggle = document.getElementById('toggle-offshore');
      const offshoreSection = document.getElementById('offshore-section');

      // Handle Calculate ROI button click
      calculateBtn.addEventListener("click", (event) => {
        event.preventDefault(); // Prevent default form submission

        let isValid = true;
        clearAllErrors();

        const fields = [
          { id: "num-pages", name: "Monthly pages", value: document.getElementById("num-pages").value, rules: { isInt: { min: 1 } }, error: "Enter a valid monthly volume." },
          { id: "usa-ft", name: "Full-Time Members", value: document.getElementById("usa-ft").value, rules: { isInt: { min: 1 } }, error: "Enter at least 1 team member." },
          { id: "usa-ft-time", name: "% time spent", value: document.getElementById("usa-ft-time").value, rules: { isInt: { min: 0, max: 100 } }, error: "Time spent must be between 0 and 100%." },
          { id: "usa-ft-rate", name: "Hourly Rate (USD)", value: document.getElementById("usa-ft-rate").value, rules: { isFloat: { min: 0.01 } }, error: "Hourly rate must be greater than $0." },
        ];

        // Validate at least one document type is selected
        if (addedDocTypes.size === 0) {
          isValid = false;
          showError(docTypesContainer, "Select at least one document type.");
        } else {
          clearError(docTypesContainer);
        }

        if (offshoreToggle.checked) {
          const offshoreFields = [
            { id: "off-ft", name: "Offshore Full-Time Members", value: document.getElementById("off-ft").value, rules: { isInt: { min: 1 } }, error: "Enter at least 1 offshore member." },
            { id: "off-ft-time", name: "Offshore % time", value: document.getElementById("off-ft-time").value, rules: { isInt: { min: 0, max: 100 } }, error: "Time spent must be between 0 and 100%." },
            { id: "off-ft-rate", name: "Offshore Hourly Rate (USD)", value: document.getElementById("off-ft-rate").value, rules: { isFloat: { min: 0.01 } }, error: "Offshore rate must be greater than $0." },
          ];
          fields.push(...offshoreFields);
        }

        fields.forEach((field) => {
          const input = document.getElementById(field.id);
          let error = "";

          if (field.rules.isInt && !validator.isInt(field.value, field.rules.isInt)) {
            error = field.error;
          } else if (field.rules.isFloat && !validator.isFloat(field.value, field.rules.isFloat)) {
            error = field.error;
          }

          if (error) {
            isValid = false;
            showError(input, error);
          }
        });

        if (isValid) {
          alert("Form is valid! Proceeding...");
        } else {
          alert("Please fix the errors before proceeding.");
        }
      });

      // Attach listeners to clear validation errors on typing
      const inputs = document.querySelectorAll("input");
      inputs.forEach((input) => {
        input.addEventListener("input", () => {
          clearError(input);
        });
      });

      // Clear all error messages
      function clearAllErrors() {
        document.querySelectorAll(".error").forEach((el) => el.classList.remove("error"));
        document.querySelectorAll(".error-message").forEach((el) => el.remove());
      }

      // Clear errors specific to offshore fields
      function clearOffshoreErrors() {
        ["off-ft", "off-ft-time", "off-ft-rate"].forEach((id) => {
          const input = document.getElementById(id);
          clearError(input);
        });
      }

      // Show an error message for a specific input
      function showError(input, message) {
      // Handle document types container separately
      if (input.id === "doc-types-container") {
        input.classList.add("error"); // Add the red border
        // Add error message below the container if not already present
        const errorLabel = document.createElement("span");
        errorLabel.className = "error-message text-red-500 text-xs mt-1";
        errorLabel.textContent = message;

        if (!input.nextElementSibling || !input.nextElementSibling.classList.contains("error-message")) {
          input.insertAdjacentElement("afterend", errorLabel);
        }
      } else {
        input.classList.add("error"); // Add red border for input fields
        const errorLabel = document.createElement("span");
        errorLabel.className = "error-message text-red-500 text-xs mt-1";
        errorLabel.textContent = message;

        if (!input.nextElementSibling || !input.nextElementSibling.classList.contains("error-message")) {
          input.insertAdjacentElement("afterend", errorLabel);
        }
      }
    }

      // Show an error message for the document types container
      function showErrorForContainer(container, message) {
        const errorLabel = document.createElement("span");
        errorLabel.className = "error-message text-red-500 text-xs mt-1";
        errorLabel.textContent = message;

        if (!container.nextElementSibling || !container.nextElementSibling.classList.contains("error-message")) {
          container.insertAdjacentElement("afterend", errorLabel);
        }
      }
    });

  </script>
</body>
</html>